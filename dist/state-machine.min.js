!function(t){"undefined"==typeof exports&&(exports="object"==typeof window?window:"object"==typeof self?self:{});var n,e="states",r="lastState",i="transitions",o="length",f="push",s="call",u="splice",a="from",c="to",l="args",p="*",d="StateMachine";exports[d]=function(t,h){var v=this,y=!1,m={},w=0,b=0,x=1,j=2,S=3;v.name=d,t="number"==typeof t?t:5,v[e]=[],v[r]=null,v[i]=[],v.setStrict=function(t){return h=t,this},v.add=function(t,n,e,r){var o=[t,n,e,r];return v[i][f](o),o},v.remove=function(t){for(var n=v[i],e=0,r=n[o];r>e;e++)if(n[e]===t){n[u](e,1);break}return this},v.to=function(d,g,k){if(y)return this;var E,M,T,q,z=!1,A=v[e],B=v[i],C=0;if(h){for(E=B[o];E>C&&!(z=B[C][b]===v[r]&&B[C][x]===d);C++);if(!z)throw new Error("The transition is invalid.")}A[f](d),M=A[o]-t-2+t,T=A[M]||null,q=A[M+1],A[u](0,A[o]-t),w=0;var D=function(t){var e,i=B[w],f=w,u=!1;!i||i[b]!==T&&i[b]!==p||i[x]!==q&&i[x]!==p?f===w&&++w<B[o]&&D(t):(e=function(t){y=!1,v[r]=q,i[S]&&i[S][s](v,T,q,t),k&&k[s](v,T,q,t),f===w&&++w<B[o]&&D(t)},m[a]=T,m[c]=q,m[l]=t,"function"==typeof i[j]?t=i[j][s](v,T,q,t,e):null!==i[j]?t=i[j]:n===t&&(t=null),n!==t&&(u=!0,e(t)),u||(y=!0))};return D(g),this}};var h={"function":!0,object:!0};h[typeof define]&&h[typeof define.amd]&&define.amd?define(function(){return exports[d]}):t[d]=exports[d]}(this);